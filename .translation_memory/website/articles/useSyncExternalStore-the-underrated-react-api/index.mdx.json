{
  "source_file_path_relative_to_docusaurus_root": "articles/useSyncExternalStore-the-underrated-react-api/index.mdx",
  "source_file_content_hash": "d837303b04cde37a19a845d82af4186f11a8e3903e147c38fe77df1f4309161d",
  "segments": [
    {
      "segment_id": "58cfcc64",
      "source_content": "---\nslug: useSyncExternalStore-the-underrated-react-api\ntitle: useSyncExternalStore - The underrated React API\nauthors: [slorber]\ndate: 2022-09-06\ntwitterThreadUrl: \"https://slo.im/t/articles/useSyncExternalStore\"\nimage: ./social-card.png\n---",
      "source_content_hash": "463e0b51872f1a5e3cc3474aefb0ec95b0298e06b01ad8226158676e1111d236",
      "node_type": "yaml",
      "translatable": false,
      "translations": {
        "ja": "@@untranslatable_placeholder_58cfcc64"
      }
    },
    {
      "segment_id": "1cc03ec8",
      "source_content": "# useSyncExternalStore - The underrated React API",
      "source_content_hash": "a5dce1687748f70717491a0c8546283cfaf4e1eef3ad7bd5c0a650be567db168",
      "node_type": "heading",
      "translatable": true,
      "translations": {
        "ja": "# useSyncExternalStore - éå°è©•ä¾¡ã•ã‚Œã¦ã„ã‚‹React API"
      }
    },
    {
      "segment_id": "8d66f911",
      "source_content": "You might have heard of [`useSyncExternalStore()`](https://reactjs.org/docs/hooks-reference.html#usesyncexternalstore), a new React 18 hook to **subscribe to external data sources**. It is often used internally by state management libraries - like [Redux](https://github.com/reduxjs/react-redux/pull/1808) - to implement a **selector system**.",
      "source_content_hash": "6dfb16c5d4df1e98625b528be600fd0ddea64f218dd284018831ea052ec868f4",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "[`useSyncExternalStore()`](https://reactjs.org/docs/hooks-reference.html#usesyncexternalstore)ã¨ã„ã†React 18ã®æ–°ãƒ•ãƒƒã‚¯ã‚’ã”å­˜çŸ¥ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã“ã‚Œã¯**å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã¸ã®è³¼èª­**ã«ä½¿ç”¨ã•ã‚Œã€[Redux](https://github.com/reduxjs/react-redux/pull/1808)ã®ã‚ˆã†ãªçŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå†…éƒ¨ã§**ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚·ã‚¹ãƒ†ãƒ **ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã«ã‚ˆãä½¿ã‚ã‚Œã¾ã™ã€‚"
      }
    },
    {
      "segment_id": "ad8fd492",
      "source_content": "But what about using `useSyncExternalStore()` in your own application code?",
      "source_content_hash": "c9027d984edb43182ebed38711b5707efe426f4ebcffc1cc3b5baacd8b777e47",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "ã—ã‹ã—ã€ç‹¬è‡ªã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã§`useSyncExternalStore()`ã‚’ä½¿ã†ã®ã¯ã©ã†ã§ã—ã‚‡ã†ã‹ï¼Ÿ"
      }
    },
    {
      "segment_id": "86b54d44",
      "source_content": "In this interactive article, I want to present you a problem: **over-returning React hooks triggering useless re-renders**. We will see how `useSyncExternalStore()` can be a good fix.",
      "source_content_hash": "0ecd869284da3cedc52e650276d0dbdf3809ccc73c7e99fc1388aa7252263aef",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "ã“ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–è¨˜äº‹ã§ã¯ã€**ç„¡é§„ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’å¼•ãèµ·ã“ã™éå‰°ãªè¿”ã‚Šå€¤ã‚’æŒã¤Reactãƒ•ãƒƒã‚¯**ã¨ã„ã†å•é¡Œã‚’æç¤ºã—ã¾ã™ã€‚`useSyncExternalStore()`ãŒã©ã®ã‚ˆã†ã«è‰¯ã„è§£æ±ºç­–ã¨ãªã‚‹ã‹ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚"
      }
    },
    {
      "segment_id": "39b3772c",
      "source_content": "![social card](./social-card.png)",
      "source_content_hash": "ecaa1722784290579cd46f92c22c424f707d55b6dacecdbd0c594d8ca5d374b4",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "![social card](./social-card.png)"
      }
    },
    {
      "segment_id": "c6da205d",
      "source_content": "<!-- truncate -->",
      "source_content_hash": "2f8566552e3b92233817e9029faa608a0a7bde771612eb57367d8dad692fdcb4",
      "node_type": "comment",
      "translatable": false,
      "translations": {
        "ja": "@@untranslatable_placeholder_c6da205d"
      }
    },
    {
      "segment_id": "5dfba1c3",
      "source_content": "<SubscribeFormEmbed />",
      "source_content_hash": "2b5c5e42f4352c90b9647a9da7a0fb7ece8b8dc27440e42cdf85cbb6e1901b85",
      "node_type": "mdxJsxFlowElement",
      "translatable": false,
      "translations": {
        "ja": "@@untranslatable_placeholder_5dfba1c3"
      }
    },
    {
      "segment_id": "0adfe0aa",
      "source_content": "import {\n  App,\n  AppFixed,\n  ScrollApp,\n} from \"@site/articles/useSyncExternalStore-the-underrated-react-api/demos\";",
      "source_content_hash": "3c91cedb564c8960af28b0ddbdcdc983c8fd75bfeb3d8c3d93827f54b99c82f1",
      "node_type": "mdxjsEsm",
      "translatable": false,
      "translations": {
        "ja": "@@untranslatable_placeholder_0adfe0aa"
      }
    },
    {
      "segment_id": "d06306f7",
      "source_content": "## Over-returning hooks",
      "source_content_hash": "ff7e4baf3d89595f00f50d75a8de1f3c357caecf5dca92ad12e68f16e92d287f",
      "node_type": "heading",
      "translatable": true,
      "translations": {
        "ja": "## éå‰°ãªè¿”ã‚Šå€¤ã‚’æŒã¤ãƒ•ãƒƒã‚¯"
      }
    },
    {
      "segment_id": "73ab96a3",
      "source_content": "Let's illustrate the problem with [`useLocation()`](https://reactrouter.com/en/main/hooks/use-location) from React-Router.",
      "source_content_hash": "081f55901fe067af42824bc0d621da75bf7c93e50a0ff311b16a38afc2d61441",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "React-Routerã®[`useLocation()`](https://reactrouter.com/en/main/hooks/use-location)ã‚’ä½¿ã£ã¦å•é¡Œã‚’èª¬æ˜ã—ã¾ã—ã‚‡ã†ã€‚"
      }
    },
    {
      "segment_id": "7499a4e7",
      "source_content": "This hook returns an object with many attributes (`pathname`, `hash`, `search`...), but you might not read all of them. Just calling the hook will trigger re-renders when any of these attributes is updated.",
      "source_content_hash": "98982ce1cf35f5fdd27a8076041d32c80cc73aee2181f01bf4199da3a95b0798",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "ã“ã®ãƒ•ãƒƒã‚¯ã¯å¤šãã®å±æ€§ï¼ˆ`pathname`ã€`hash`ã€`search`ãªã©ï¼‰ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã—ã¾ã™ãŒã€ã™ã¹ã¦ã‚’ä½¿ç”¨ã™ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å˜ã«ãƒ•ãƒƒã‚¯ã‚’å‘¼ã³å‡ºã™ã ã‘ã§ã€ã“ã‚Œã‚‰ã®å±æ€§ã®ã„ãšã‚Œã‹ãŒæ›´æ–°ã•ã‚Œã‚‹ã¨å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒç™ºç”Ÿã—ã¾ã™ã€‚"
      }
    },
    {
      "segment_id": "517051a7",
      "source_content": "Let's consider this app:",
      "source_content_hash": "03e7684b96fcdc3a5be6239120a717998a33a0fa9aef1e2dbac14b5510178f74",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "æ¬¡ã®ã‚¢ãƒ—ãƒªã‚’è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ï¼š"
      }
    },
    {
      "segment_id": "4dd51304",
      "source_content": "```tsx\nfunction CurrentPathname() {\n  const { pathname } = useLocation();\n  return <div>{pathname}</div>;\n}\n\nfunction CurrentHash() {\n  const { hash } = useLocation();\n  return <div>{hash}</div>;\n}\n\nfunction Links() {\n  return (\n    <div>\n      <Link to=\"#link1\">#link1</Link>\n      <Link to=\"#link2\">#link2</Link>\n      <Link to=\"#link3\">#link3</Link>\n    </div>\n  );\n}\n\nfunction App() {\n  return (\n    <div>\n      <CurrentPathname />\n      <CurrentHash />\n      <Links />\n    </div>\n  );\n}\n```",
      "source_content_hash": "68154e04385021e320c4366a29b2a63fe3fdfca2c8d2869ff9aa3e50fc837d5b",
      "node_type": "code",
      "translatable": false,
      "translations": {
        "ja": "@@untranslatable_placeholder_4dd51304"
      }
    },
    {
      "segment_id": "61a24b68",
      "source_content": "<App />",
      "source_content_hash": "020525fda7385f0f59c01976613d6828f508370400f3d4eb58b2aa56b1cf4fd0",
      "node_type": "mdxJsxFlowElement",
      "translatable": false,
      "translations": {
        "ja": "@@untranslatable_placeholder_61a24b68"
      }
    },
    {
      "segment_id": "147e8550",
      "source_content": "On any hash link click, the `CurrentPathname` component will re-render, even if it's not even using the `hash` attribute ğŸ˜….",
      "source_content_hash": "7619fee1f11b97c47972777ab65a4a716a1a837a03f3eef068629e2c3141b43f",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "ãƒãƒƒã‚·ãƒ¥ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ãŸã³ã«ã€`CurrentPathname`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯`hash`å±æ€§ã‚’ä½¿ç”¨ã—ã¦ã„ãªã„ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ğŸ˜…ã€‚"
      }
    },
    {
      "segment_id": "07837485",
      "source_content": ":::tip\nWhenever a hook returns data that you don't display, think about React re-renders. If you don't pay attention, a tiny `useLocation()` call added at the top of a React tree could harm your app's performance.\n:::",
      "source_content_hash": "17957b5dab10b87533922ca14d2b9a99b200be24646ca8c82ae182d1c0373096",
      "node_type": "containerDirective",
      "translatable": true,
      "translations": {
        "ja": ":::tip\nãƒ•ãƒƒã‚¯ãŒè¡¨ç¤ºã—ãªã„ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™å ´åˆã€Reactã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã«ã¤ã„ã¦è€ƒãˆã¦ãã ã•ã„ã€‚æ³¨æ„ã‚’æ‰•ã‚ãªã„ã¨ã€Reactãƒ„ãƒªãƒ¼ã®ä¸Šéƒ¨ã«è¿½åŠ ã•ã‚ŒãŸå°ã•ãª`useLocation()`å‘¼ã³å‡ºã—ãŒã‚¢ãƒ—ãƒªã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æãªã†å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\n:::"
      }
    },
    {
      "segment_id": "0286b5a7",
      "source_content": ":::info\nThe goal is not to criticize React-Router, but rather to illustrate the problem. `useLocation()` is just a good pragmatic candidate to create this interactive article. Your own React hooks and other third-party libraries might also over-return.\n:::",
      "source_content_hash": "fe5b946392c7edf2cd3736363e8ae40cab03fd861a063a08bcedcdc9e86a8d95",
      "node_type": "containerDirective",
      "translatable": true,
      "translations": {
        "ja": ":::info\nç›®æ¨™ã¯React-Routerã‚’æ‰¹åˆ¤ã™ã‚‹ã“ã¨ã§ã¯ãªãã€å•é¡Œã‚’èª¬æ˜ã™ã‚‹ã“ã¨ã§ã™ã€‚`useLocation()`ã¯ã“ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–è¨˜äº‹ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®ç¾å®Ÿçš„ãªä¾‹ã«éãã¾ã›ã‚“ã€‚ç‹¬è‡ªã®Reactãƒ•ãƒƒã‚¯ã‚„ä»–ã®ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚‚éå‰°ãªè¿”ã‚Šå€¤ã‚’è¿”ã™å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\n:::"
      }
    },
    {
      "segment_id": "8a9b6c26",
      "source_content": "## `useSyncExternalStore` to the rescue?",
      "source_content_hash": "400cf51319f48185cb1654c635f0786bb996bfbd4da99014c4dcfab57672e69b",
      "node_type": "heading",
      "translatable": true,
      "translations": {
        "ja": "## `useSyncExternalStore`ã§è§£æ±ºï¼Ÿ"
      }
    },
    {
      "segment_id": "a1fa5396",
      "source_content": "The [official documentation](https://reactjs.org/docs/hooks-reference.html#usesyncexternalstore) says:",
      "source_content_hash": "ffe360c34f7eaf872a0882b603075229fb5eb7525f52020e2ad92a93c8a08dae",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://reactjs.org/docs/hooks-reference.html#usesyncexternalstore)ã«ã¯æ¬¡ã®ã‚ˆã†ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™ï¼š"
      }
    },
    {
      "segment_id": "fe7364bf",
      "source_content": "> useSyncExternalStore is a hook recommended for reading and subscribing from external data sources in a way thatâ€™s compatible with concurrent rendering features like selective hydration and time slicing.\n> This method returns the value of the store and accepts three arguments:\n>\n> * `subscribe`: function to register a callback that is called whenever the store changes.\n> * `getSnapshot`: function that returns the current value of the store.\n> * `getServerSnapshot`: function that returns the snapshot used during server rendering.",
      "source_content_hash": "1b1de9e500fe68bcd8994a12619faaa3bef023c349e30685bbdb1f9befe69ea4",
      "node_type": "blockquote",
      "translatable": true,
      "translations": {
        "ja": "> useSyncExternalStoreã¯ã€é¸æŠçš„ãªãƒã‚¤ãƒ‰ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã‚¿ã‚¤ãƒ ã‚¹ãƒ©ã‚¤ã‚¹ãªã©ã®ã‚³ãƒ³ã‚«ãƒ¬ãƒ³ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ©Ÿèƒ½ã¨äº’æ›æ€§ã®ã‚ã‚‹æ–¹æ³•ã§ã€å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‹ã‚‰ã®èª­ã¿å–ã‚Šã¨è³¼èª­ã«æ¨å¥¨ã•ã‚Œã‚‹ãƒ•ãƒƒã‚¯ã§ã™ã€‚\n> ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã‚¹ãƒˆã‚¢ã®å€¤ã‚’è¿”ã—ã€3ã¤ã®å¼•æ•°ã‚’å—ã‘å–ã‚Šã¾ã™ï¼š\n>\n> * `subscribe`: ã‚¹ãƒˆã‚¢ãŒå¤‰æ›´ã•ã‚Œã‚‹ãŸã³ã«å‘¼ã³å‡ºã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ç™»éŒ²ã™ã‚‹é–¢æ•°\n> * `getSnapshot`: ã‚¹ãƒˆã‚¢ã®ç¾åœ¨ã®å€¤ã‚’è¿”ã™é–¢æ•°\n> * `getServerSnapshot`: ã‚µãƒ¼ãƒãƒ¼ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ä¸­ã«ä½¿ç”¨ã•ã‚Œã‚‹ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’è¿”ã™é–¢æ•°"
      }
    },
    {
      "segment_id": "5782e280",
      "source_content": "```tsx\nfunction useSyncExternalStore<Snapshot>(\n  subscribe: (onStoreChange: () => void) => () => void,\n  getSnapshot: () => Snapshot,\n  getServerSnapshot?: () => Snapshot,\n): Snapshot;\n```",
      "source_content_hash": "37049ffb849ff33cab894cfeba415b68d66bfdeece444d5596cece028b53532b",
      "node_type": "code",
      "translatable": false,
      "translations": {
        "ja": "@@untranslatable_placeholder_5782e280"
      }
    },
    {
      "segment_id": "25212439",
      "source_content": "This feels a bit abstract. This [beta doc page](https://beta.reactjs.org/learn/you-might-not-need-an-effect#subscribing-to-an-external-store) gives a good example:",
      "source_content_hash": "ca7536d7acd70832a20fcb4ee80bc28d5d800cb6f7e21083126da9b18926ed8f",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "ã“ã‚Œã¯å°‘ã—æŠ½è±¡çš„ã§ã™ã€‚ã“ã®[ãƒ™ãƒ¼ã‚¿ç‰ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒšãƒ¼ã‚¸](https://beta.reactjs.org/learn/you-might-not-need-an-effect#subscribing-to-an-external-store)ã«ã¯è‰¯ã„ä¾‹ãŒã‚ã‚Šã¾ã™ï¼š"
      }
    },
    {
      "segment_id": "cae897fb",
      "source_content": "```tsx\nfunction subscribe(callback) {\n  window.addEventListener(\"online\", callback);\n  window.addEventListener(\"offline\", callback);\n  return () => {\n    window.removeEventListener(\"online\", callback);\n    window.removeEventListener(\"offline\", callback);\n  };\n}\n\nfunction useOnlineStatus() {\n  return useSyncExternalStore(\n    subscribe,\n    () => navigator.onLine,\n    () => true,\n  );\n}\n\nfunction ChatIndicator() {\n  const isOnline = useOnlineStatus();\n  // ...\n}\n```",
      "source_content_hash": "9dbd0e80ea7b7d17e5c3341cf8de124068bd2080dd2c15c3e18b8602bee18bd4",
      "node_type": "code",
      "translatable": false,
      "translations": {
        "ja": "@@untranslatable_placeholder_cae897fb"
      }
    },
    {
      "segment_id": "b9331170",
      "source_content": "It turns out that the browser history can also be considered as an external data source. Let's see how to use `useSyncExternalStore` with React-Router!",
      "source_content_hash": "ddb9900449da77cfb3672b7d96771bd9370737c14d5971b33dfc22e94cac2c5a",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "ãƒ–ãƒ©ã‚¦ã‚¶ã®å±¥æ­´ã‚‚å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã¨è¦‹ãªã›ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚React-Routerã§`useSyncExternalStore`ã‚’ä½¿ã†æ–¹æ³•ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼"
      }
    },
    {
      "segment_id": "2bb63d77",
      "source_content": "## Implementing `useHistorySelector()`",
      "source_content_hash": "eafdc1d47619b50cf44fa76487aa0162ba785ed2de67d9a40997219f0d38d03b",
      "node_type": "heading",
      "translatable": true,
      "translations": {
        "ja": "## `useHistorySelector()`ã®å®Ÿè£…"
      }
    },
    {
      "segment_id": "53aa2b95",
      "source_content": "React-Router expose everything we need to wire `useSyncExternalStore`:",
      "source_content_hash": "05a88ff7a73ab9d40d3f883378482fa054421fab9e33d9a92f62f3e7249483ba",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "React-Routerã¯`useSyncExternalStore`ã‚’æ¥ç¶šã™ã‚‹ãŸã‚ã«å¿…è¦ãªã™ã¹ã¦ã‚’å…¬é–‹ã—ã¦ã„ã¾ã™ï¼š"
      }
    },
    {
      "segment_id": "d8460b5b",
      "source_content": "* access the browser history with [`useHistory()`](https://v5.reactrouter.com/web/api/Hooks/usehistory)\n* subscribe for history updates with [`history.listen(callback)`](https://github.com/remix-run/history/blob/main/docs/api-reference.md#history.listen)\n* access a snapshot of the current location with [`history.location`](https://github.com/remix-run/history/blob/main/docs/api-reference.md#historylocation)",
      "source_content_hash": "6b3a78c506ef3a89d4761a83c80451b0c068b279ed33b843dfacf92008a00ed4",
      "node_type": "list",
      "translatable": true,
      "translations": {
        "ja": "* [`useHistory()`](https://v5.reactrouter.com/web/api/Hooks/usehistory)ã§ãƒ–ãƒ©ã‚¦ã‚¶å±¥æ­´ã«ã‚¢ã‚¯ã‚»ã‚¹\n* [`history.listen(callback)`](https://github.com/remix-run/history/blob/main/docs/api-reference.md#history.listen)ã§å±¥æ­´æ›´æ–°ã‚’è³¼èª­\n* [`history.location`](https://github.com/remix-run/history/blob/main/docs/api-reference.md#historylocation)ã§ç¾åœ¨ã®ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹"
      }
    },
    {
      "segment_id": "a1600d1d",
      "source_content": ":::caution\nThis website uses React-Router v5: the solution will be different for React-Router v6 ([see](https://twitter.com/Zh0uzi/status/1567523679604539405)).\n:::",
      "source_content_hash": "0a929c82979d512fc7a3ac02a56a1b6e1a6d4a10dc3cdcd2883b88f6b1dc403c",
      "node_type": "containerDirective",
      "translatable": true,
      "translations": {
        "ja": ":::caution\nã“ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã¯React-Router v5ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™: React-Router v6ã§ã¯è§£æ±ºç­–ãŒç•°ãªã‚Šã¾ã™ï¼ˆ[å‚ç…§](https://twitter.com/Zh0uzi/status/1567523679604539405)ï¼‰ã€‚\n:::"
      }
    },
    {
      "segment_id": "bb1346b6",
      "source_content": "The implementation of `useHistorySelector()` relatively simple:",
      "source_content_hash": "b35e0181ebd2bfc4c81f65c23a0f9d0f7f3463efbe7a7e26d901e55885c44146",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "`useHistorySelector()`ã®å®Ÿè£…ã¯æ¯”è¼ƒçš„ã‚·ãƒ³ãƒ—ãƒ«ã§ã™:"
      }
    },
    {
      "segment_id": "8a061704",
      "source_content": "```tsx\nfunction useHistorySelector(selector) {\n  const history = useHistory();\n  return useSyncExternalStore(history.listen, () =>\n    selector(history),\n  );\n}\n```",
      "source_content_hash": "4148e4d5489e39f6a64e209787c2e0056a9c8017ca8cea0497fe8f570dc88715",
      "node_type": "code",
      "translatable": false,
      "translations": {
        "ja": "@@untranslatable_placeholder_8a061704"
      }
    },
    {
      "segment_id": "719d3997",
      "source_content": "Let's use it in our app:",
      "source_content_hash": "c5c2687980ae5832f77ef92f44860c31bcbc3f293e6aa0197c09ef526f9e4c84",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "ã“ã‚Œã‚’ã‚¢ãƒ—ãƒªã§ä½¿ç”¨ã—ã¦ã¿ã¾ã—ã‚‡ã†:"
      }
    },
    {
      "segment_id": "5d30fd9b",
      "source_content": "```tsx\nfunction CurrentPathname() {\n  const pathname = useHistorySelector(\n    (history) => history.location.pathname,\n  );\n  return <div>{pathname}</div>;\n}\n\nfunction CurrentHash() {\n  const hash = useHistorySelector(\n    (history) => history.location.hash,\n  );\n  return <div>{hash}</div>;\n}\n```",
      "source_content_hash": "8634c51e60804ee12e2db7021ea554920b0c5828f7c8517b94fc42126e367a79",
      "node_type": "code",
      "translatable": false,
      "translations": {
        "ja": "@@untranslatable_placeholder_5d30fd9b"
      }
    },
    {
      "segment_id": "dd56b068",
      "source_content": "<AppFixed />",
      "source_content_hash": "b52353ceb24bec063e10ce1dc5ecc46db4114eab4ab9dbca5589fef80f4b5f5b",
      "node_type": "mdxJsxFlowElement",
      "translatable": false,
      "translations": {
        "ja": "@@untranslatable_placeholder_dd56b068"
      }
    },
    {
      "segment_id": "d636abf8",
      "source_content": "Now, when you click on a hash link above, the `CurrentPathname` component will **not re-render** anymore!",
      "source_content_hash": "52c5a811f7ee0105a3589cea54499ad70d2e14d33667189d4602b7a7b9675fed",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "ã“ã‚Œã§ã€ä¸Šè¨˜ã®ãƒãƒƒã‚·ãƒ¥ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚ã€`CurrentPathname`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯**å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œãªããªã‚Šã¾ã—ãŸ**ï¼"
      }
    },
    {
      "segment_id": "191265da",
      "source_content": "## Another example: `scrollY`",
      "source_content_hash": "7e9f3116e38ee27a6f6289a62d11a3a77c61b0c69e09a7dbdc270ba88582512b",
      "node_type": "heading",
      "translatable": true,
      "translations": {
        "ja": "## åˆ¥ã®ä¾‹: `scrollY`"
      }
    },
    {
      "segment_id": "85ea22dd",
      "source_content": "There are so many external data sources that we can subscribe to, and implementing your own selector system on top might enable you to optimize React re-renders.",
      "source_content_hash": "f1e322ed225b706cfd909fd503f4859510dac8fd323b9987c3d60068ad1420bc",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "è³¼èª­å¯èƒ½ãªå¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã¯æ•°å¤šãã‚ã‚Šã€ç‹¬è‡ªã®ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§Reactã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’æœ€é©åŒ–ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚"
      }
    },
    {
      "segment_id": "dc72fd20",
      "source_content": "For example, let's consider we want to use the `scrollY` position of a page. We can implement this custom React hook:",
      "source_content_hash": "b6da6b19ff461c56fac08e138cdc6f75b410b530fc56e8645ce036bc9fcd25be",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "ä¾‹ãˆã°ã€ãƒšãƒ¼ã‚¸ã®`scrollY`ä½ç½®ã‚’ä½¿ç”¨ã—ãŸã„å ´åˆã‚’è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚ä»¥ä¸‹ã®ã‚ˆã†ãªã‚«ã‚¹ã‚¿ãƒ Reactãƒ•ãƒƒã‚¯ã‚’å®Ÿè£…ã§ãã¾ã™:"
      }
    },
    {
      "segment_id": "82a37a1b",
      "source_content": "```tsx\n// A memoized constant fn prevents unsubscribe/resubscribe\n// In practice it is not a big deal\nfunction subscribe(onStoreChange) {\n  global.window?.addEventListener(\"scroll\", onStoreChange);\n  return () =>\n    global.window?.removeEventListener(\n      \"scroll\",\n      onStoreChange,\n    );\n}\n\nfunction useScrollY(selector = (id) => id) {\n  return useSyncExternalStore(\n    subscribe,\n    () => selector(global.window?.scrollY),\n    () => undefined,\n  );\n}\n```",
      "source_content_hash": "3134d48752dbf7c9e77d0265a5ad9145df658c032aeda0d6c8257804603f28db",
      "node_type": "code",
      "translatable": false,
      "translations": {
        "ja": "@@untranslatable_placeholder_82a37a1b"
      }
    },
    {
      "segment_id": "3208eb29",
      "source_content": "We can now use this hook with an optional selector:",
      "source_content_hash": "5fe7994bac2ddf6c3169f35371c74ed5c013ea4d6a5f4689b259fc0b0c38717a",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "ã“ã®ãƒ•ãƒƒã‚¯ã‚’ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã¨å…±ã«ä½¿ç”¨ã§ãã¾ã™:"
      }
    },
    {
      "segment_id": "3c6be27a",
      "source_content": "```tsx\nfunction ScrollY() {\n  const scrollY = useScrollY();\n  return <div>{scrollY}</div>;\n}\n\nfunction ScrollYFloored() {\n  const to = 100;\n  const scrollYFloored = useScrollY((y) =>\n    y ? Math.floor(y / to) * to : undefined,\n  );\n  return <div>{scrollYFloored}</div>;\n}\n```",
      "source_content_hash": "4d300d3a281610e30302fe8d59abb4edbd06478886eb3c15309eb614caf0beb1",
      "node_type": "code",
      "translatable": false,
      "translations": {
        "ja": "@@untranslatable_placeholder_3c6be27a"
      }
    },
    {
      "segment_id": "b150092b",
      "source_content": "<ScrollApp />",
      "source_content_hash": "87e4dd8dae5f49eedd8ebe8eebe3f85246f0f5048d947e97cfcbac76dcc6f776",
      "node_type": "mdxJsxFlowElement",
      "translatable": false,
      "translations": {
        "ja": "@@untranslatable_placeholder_b150092b"
      }
    },
    {
      "segment_id": "d8c366cc",
      "source_content": "Scroll the page and see how the components above re-render? One is re-rendering less than the other!",
      "source_content_hash": "98e6dd5231b50293e3baae90be4411d8ba43083ef1e6c5a14a5b049dc5cf35ce",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "ãƒšãƒ¼ã‚¸ã‚’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã€ä¸Šè¨˜ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã©ã®ã‚ˆã†ã«å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã‹ç¢ºèªã—ã¾ã—ãŸã‹ï¼Ÿä¸€æ–¹ãŒä»–æ–¹ã‚ˆã‚Šã‚‚å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å›æ•°ãŒå°‘ãªã„ã§ã™ï¼"
      }
    },
    {
      "segment_id": "59087b4e",
      "source_content": ":::info\nWhen you don't need a `scrollY` 1 pixel precision level, returning a wide range value such as `scrollY` can also be considered as over-returning. Consider returning a narrower value.\n\nFor example: a `useResponsiveBreakpoint()` hook that only returns a limited set of values (`small`, `medium` or `large`) will be more optimized than a `useViewportWidth()` hook.\n\nIf a React component only handles `large` screens differently, you can create an even narrower `useIsLargeScreen()` hook returning a boolean.\n:::",
      "source_content_hash": "05a90436211c9e78c07c86b6d930646ed56fcfe5f974911b929881f3ac140437",
      "node_type": "containerDirective",
      "translatable": true,
      "translations": {
        "ja": ":::info\n`scrollY`ã®1ãƒ”ã‚¯ã‚»ãƒ«ãƒ¬ãƒ™ãƒ«ã®ç²¾åº¦ãŒå¿…è¦ãªã„å ´åˆã€`scrollY`ã®ã‚ˆã†ãªåºƒç¯„å›²ã®å€¤ã‚’è¿”ã™ã“ã¨ã‚‚éå‰°ãªè¿”å´ã¨è¦‹ãªã›ã¾ã™ã€‚ã‚ˆã‚Šç‹­ã„å€¤ã‚’è¿”ã™ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚\n\nä¾‹ãˆã°: `small`ã€`medium`ã€`large`ã¨ã„ã£ãŸé™ã‚‰ã‚ŒãŸå€¤ã‚»ãƒƒãƒˆã®ã¿ã‚’è¿”ã™`useResponsiveBreakpoint()`ãƒ•ãƒƒã‚¯ã¯ã€`useViewportWidth()`ãƒ•ãƒƒã‚¯ã‚ˆã‚Šã‚‚æœ€é©åŒ–ã•ã‚Œã¾ã™ã€‚\n\nReactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ`large`ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã®ã¿ã‚’ç‰¹åˆ¥ã«æ‰±ã†å ´åˆã€ã•ã‚‰ã«é™å®šã•ã‚ŒãŸ`useIsLargeScreen()`ãƒ•ãƒƒã‚¯ã‚’booleanã§è¿”ã™ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚\n:::"
      }
    },
    {
      "segment_id": "63daebc9",
      "source_content": "## Conclusion",
      "source_content_hash": "be031d37bb75d96ef08ca9ec5b0e83bb6f91172f60d3c31a78feae8d7dc4a0b0",
      "node_type": "heading",
      "translatable": true,
      "translations": {
        "ja": "## çµè«–"
      }
    },
    {
      "segment_id": "228d01d5",
      "source_content": "I hope this article convinced you to take a second look at `useSyncExternalStore()`. I feel this hook is currently underused in the React ecosystem, and deserves a bit more attention. There are many external data sources that you can subscribe to.",
      "source_content_hash": "1355fc1bdf09826d3a4978436b82e8fe95c93e087e30878f49eff5d02f8ede88",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "ã“ã®è¨˜äº‹ãŒã€`useSyncExternalStore()`ã‚’ã‚‚ã†ä¸€åº¦è¦‹ç›´ã™ãã£ã‹ã‘ã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚ã“ã®ãƒ•ãƒƒã‚¯ã¯ç¾åœ¨Reactã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã§ååˆ†ã«æ´»ç”¨ã•ã‚Œã¦ãŠã‚‰ãšã€ã‚‚ã†å°‘ã—æ³¨ç›®ã•ã‚Œã‚‹ä¾¡å€¤ãŒã‚ã‚‹ã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚è³¼èª­å¯èƒ½ãªå¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã¯æ•°å¤šãå­˜åœ¨ã—ã¾ã™ã€‚"
      }
    },
    {
      "segment_id": "85b17c36",
      "source_content": "If you still haven't upgraded to React 18, there's a npm [use-sync-external-store](https://www.npmjs.com/package/use-sync-external-store) shim that you can already use today in older versions. There is also a `use-sync-external-store/with-selector` export in case you need to return a memoized non-primitive value.",
      "source_content_hash": "b68310ecc785b49d09f5e05131808002c23cb580be2399153172b3f21d43a2e6",
      "node_type": "paragraph",
      "translatable": true,
      "translations": {
        "ja": "ã¾ã React 18ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ã„ãªã„å ´åˆã€npmã®[use-sync-external-store](https://www.npmjs.com/package/use-sync-external-store)ã‚·ãƒ£ãƒ ã‚’å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã™ã§ã«ä½¿ç”¨ã§ãã¾ã™ã€‚ã¾ãŸã€ãƒ¡ãƒ¢åŒ–ã•ã‚ŒãŸéãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å€¤ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚‹å ´åˆã¯`use-sync-external-store/with-selector`ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚‚åˆ©ç”¨å¯èƒ½ã§ã™ã€‚"
      }
    }
  ],
  "target_i18n_subpath": "docusaurus-plugin-content-blog-articles/useSyncExternalStore-the-underrated-react-api/index.mdx",
  "last_updated_timestamp": "2025-06-12T01:21:11.032633+00:00",
  "schema_version": "1.0",
  "translated_versions": {
    "ja": "d837303b04cde37a19a845d82af4186f11a8e3903e147c38fe77df1f4309161d"
  }
}